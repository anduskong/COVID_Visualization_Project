# Data sources

COVID-19 caught the world’s attention in January 2020 when the first several cases were reported in Wuhan, China. It quickly spread to places including Iran, South Korea, and Italy in February, and the US had its first wave in March. Since then, over 10 million cases were reported and over 260,000 Americans died. Our group wants to study the patterns in COVID-19 cases and deaths in the United States on national and state levels and recently learned about the COVID Tracking Project (https://covidtracking.com/) at the Atlantic.

The data API page has historical COVID-19 data on the national level (https://api.covidtracking.com/v1/us/daily.csv) and state level (https://api.covidtracking.com/v1/states/daily.csv). The data is also available in json format, but we will proceed with the csv format.

The national level data has the date on a daily basis, cumulative number of positive and negative test results, number of current and cumulative hospitalized people, number of current and cumulative people on ventilators, number of recovered people, and the number of deaths for each day. The state level data has similar information, but for each state. However, certain rows such as antibody test results are not available for every state, so we will proceed with columns mentioned above, which are available for all states. We can also feature engineer and calculate the number of new cases/hospitalizations/deaths/test results.

Furthermore, we will research throughout the project to gather the current events data for the United States in 2020. These data points will be used in the visualizations as key dates that could have sparked an increase in the COVID-19 cases (e.g. Easter, Memorial Day, Protests, Election). At first, we will refer to “2020 in the United States” Wikipedia page to find more reliable sources about the important events and their settings in 2020. The sources will increase throughout the project and they will be cited in Works Cited.

```{r}
library(data.table)
library(dplyr)
# file_directory <- "C:/Users/wkong/Desktop/Columbia/STAT 5702 Exploratory Data Analysis/Final Project"
# file_name <- "daily_us.csv"
# data_file <- file.path(file_directory, file_name)

df_us <- fread("daily_us.csv")
df_us <- df_us %>% mutate(date = as.Date(as.character(date), '%Y%m%d'))

# file_name <- "daily_state.csv"
# data_file <- file.path(file_directory, file_name)
df_state <- fread("daily_state.csv")
```

```{r}
library(dplyr)
library(tidyr)
library(parcoords)
df_state <- df_state %>% mutate(date = as.Date(as.character(df_state$date), "%Y%m%d"))
temp2 <- df_state %>% mutate(region = case_when(
  state %in% c("ME", "MA", "RI", "CT", "NH", "VT", "NY", "PA", "NJ", "DE", "MD", "DC") ~ "Northeast",
  state %in% c("WV", "VA", "KY", "TN", "NC", "SC", "GA", "AL", "MS", "AR", "LA", "FL") ~ "Southeast",
  state %in% c("OH", "IN", "MI", "IL", "MO", "WI", "MN", "IA", "KS", "NE", "SD", "ND") ~ "Midwest",
  state %in% c("TX", "OK", "NM", "AZ") ~ "Southwest",
  state %in% c("CO", "WY", "MT", "ID", "WA", "OR", "UT", "NV", "CA", "AK", "HI") ~ "West",
  TRUE ~ "Territories")
)



df_state %>% mutate(diff = total - positive - negative, indicator = diff !=0) %>% filter(indicator == FALSE) %>% select(diff) %>% table
df_state %>% filter( is.na(totalTestResults))

December <- df_state %>% filter(date == as.Date('20201211', '%Y%m%d'))
temp <- December %>% mutate(positivity_rate = positive / totalTestResults) %>% 
  select(state, positive, positiveIncrease, positivity_rate, deathConfirmed)
parcoords(temp, brushMode = "1d-axes", reorderable = TRUE, rownames = FALSE)
```

```{r}
library(fivethirtyeight)
library(parcoords)

parcoords(pulitzer, brushMode = "1d-axes", reorderable = TRUE, rownames = FALSE)

parcoords(temp, )
```

```{r}
library(ggplot2)
p <- ggplot(data = df_us, aes(date, positiveIncrease))
p + geom_line(size = 1, color = 'blue') + theme_light()
```

```{r}
df_us <- df_us %>% mutate(positivity = positiveIncrease / totalTestResultsIncrease)
p <- ggplot(data = df_us, aes(date, positivity))
p + geom_line()
```

```{r}
p <- ggplot(data = df_state %>% filter(state == 'WA'), aes(date, positiveIncrease))
p + geom_line(size = 1, color = 'blue') + theme_light()
```

```{r}
# file_name <- "SCPRC-EST2019-18+POP-RES.csv"
# data_file <- file.path(file_directory, file_name)
# state_pop <- fread(data_file)
state_pop <- fread("SCPRC-EST2019-18+POP-RES.csv")
state_to_abb <- data.frame(datasets::state.abb, datasets::state.name)
temp3 <- merge(state_pop, state_to_abb,by.x = "NAME", by.y = "datasets..state.name")
temp4 <- merge(temp2, temp3, by.x = "state", by.y = "datasets..state.abb")
regions <- temp4 %>% mutate(positivity = positiveIncrease / totalTestResultsIncrease,
                 positiveIncrease_per_capita = positiveIncrease / POPESTIMATE2019) %>%
  select(state, region, positivity, positiveIncrease, positiveIncrease_per_capita, date)

p <- ggplot(data = regions %>% filter(!is.na(positivity)), aes(x = positivity,y = positiveIncrease_per_capita, col = region))
p + geom_point(alpha = .2, stroke = 0, na.rm = TRUE)+geom_density_2d(lwd = 0.5)+theme_classic()
```
